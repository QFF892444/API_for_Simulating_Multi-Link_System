(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     62925,       1318]
NotebookOptionsPosition[     62031,       1298]
NotebookOutlinePosition[     62385,       1314]
CellTagsIndexPosition[     62342,       1311]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Impact", " ", "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SetUpImpacts", "[", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "Create", " ", "a", " ", "list", " ", "of", " ", "impact", " ", 
           RowBox[{"conditions", ".", " ", "Pre"}]}], "-", 
          RowBox[{"compute", " ", "certain", " ", "values"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"1.", " ", "\[Phi]s"}], ";", "\[IndentingNewLine]", 
         RowBox[{"2.", " ", "\[Phi]sgrad"}], ";", "\[IndentingNewLine]", 
         RowBox[{"3.", " ", "\[Phi]sgradDOT\[CapitalLambda]s"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"4.", " ", "\[Phi]sIsClose"}], ";", "\[IndentingNewLine]", 
         RowBox[{"5.", " ", "\[Phi]sIsInLine"}], ";"}], "\[IndentingNewLine]",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Phi]s", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Phi]sIsClose", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Phi]sIsInLine", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"delete", " ", "this", " ", "later"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"repQsToQsvar", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"qs", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
               RowBox[{"qsvars", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tmp", "=", 
            RowBox[{"tmp", "/.", "repQsToQsvar"}]}], ";"}]}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"nimpObjVertexs", "=", 
         RowBox[{"Length", "[", "impObjVertexs", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nimpObjEdges", "=", 
         RowBox[{"Length", "[", "impObjEdges", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", "nimpObjVertexs"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", "nimpObjEdges"}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"impObjVertexGroupIDs", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "==", 
                RowBox[{"impObjEdgeGroupIDs", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"v", "=", 
              RowBox[{"impObjVertexs", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"1", ";;", "2"}], ",", "1"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ev1", "=", 
              RowBox[{"impObjEdges", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "1"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ev2", "=", 
              RowBox[{"impObjEdges", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "2"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x0", "=", 
              RowBox[{"v", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"v", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"x1", "=", 
              RowBox[{"ev1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"y1", "=", 
              RowBox[{"ev1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"x2", "=", 
              RowBox[{"ev2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"y2", "=", 
              RowBox[{"ev2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"add", " ", "a", " ", "new", " ", "impact"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"\[Phi]new", "=", 
              RowBox[{"Simplify", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y0", "-", "y2"}], ")"}], "*", 
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}]}], "-", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x0", "-", "x2"}], ")"}], "*", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}]}]}], ",", 
                RowBox[{"qs", "\[Element]", "Reals"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{
                "i", ",", "\"\<,\>\"", ",", "j", ",", "\"\<,\>\"", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y0", "-", "y2"}], ")"}], "*", 
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}]}], ",", "\"\<,\>\"", ",", 
                 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"x0", "-", "x2"}], ")"}], "*", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}]}]}], "]"}], ";"}], "*)"}],
              "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"\[Phi]s", ",", "\[Phi]new"}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<i=\>\"", ",", "i", ",", "\"\<,j=\>\"", ",", "j"}], "]"}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<    edge vert 1:\>\"", ",", "ev1", ",", 
                 "\"\<,edge vert 2:\>\"", ",", "ev2", ",", "\"\<, vert0:\>\"",
                  ",", "v"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"tmp1", "=", 
              RowBox[{"Simplify", "[", 
               RowBox[{
                RowBox[{"DistPointToLine", "[", 
                 RowBox[{"ev1", ",", "ev2", ",", "v"}], "]"}], ",", 
                RowBox[{"qs", "\[Element]", "Reals"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"\[Phi]sIsClose", ",", "tmp1"}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"tmp2", "=", 
              RowBox[{"Simplify", "[", 
               RowBox[{
                RowBox[{"isInLine", "[", 
                 RowBox[{"ev1", ",", "ev2", ",", "v"}], "]"}], ",", 
                RowBox[{"qs", "\[Element]", "Reals"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"\[Phi]sIsInLine", ",", "tmp2"}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "ENDIF"}]}], 
           "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"impactTable", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Phi]sIsClose", "[", 
               RowBox[{"[", "i", "]"}], "]"}], " ", "&&", " ", 
              RowBox[{"\[Phi]sIsInLine", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "n\[Phi]s"}], "}"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"impactCons", "=", 
           RowBox[{"Apply", "[", 
            RowBox[{"Nor", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"\[Phi]sIsClose", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], " ", "&&", " ", 
                RowBox[{"\[Phi]sIsInLine", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "n\[Phi]s"}], "}"}]}], "]"}]}], 
            "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Right", " ", "side", " ", "of", " ", "impact", " ", "equations"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"n\[Phi]s", "=", 
         RowBox[{"Length", "[", "\[Phi]s", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "Simultaneous", " ", "impacts", "\[IndentingNewLine]", 
            "\[CapitalLambda]s"}], "=", 
           SuperscriptBox[
            RowBox[{"{", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Symbol", "[", 
                RowBox[{"\"\<$\[CapitalLambda]\>\"", "<>", 
                 RowBox[{"ToString", "@", "i"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "n\[Phi]s"}], "}"}]}], "]"}], "}"}], 
            "\[Transpose]"]}], ";", "\[IndentingNewLine]", 
          RowBox[{"\[Phi]sgrad", "=", 
           SuperscriptBox[
            RowBox[{"Grad", "[", 
             RowBox[{"\[Phi]s", ",", "qs"}], "]"}], "\[Transpose]"]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Phi]sgradDOT\[CapitalLambda]s", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"\[Phi]sgrad", ".", "\[CapitalLambda]s"}], "]"}]}], ";"}],
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Assume", " ", "there", " ", "is", " ", "only", " ", "one", " ", 
          "impact", " ", "at", " ", "a", " ", "time"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"\[Phi]sgrad", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"\[Phi]s", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "qs"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "n\[Phi]s"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Phi]sgradDOT\[CapitalLambda]", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Phi]sgrad", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "*", "\[CapitalLambda]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "n\[Phi]s"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Left", " ", "side", " ", "of", " ", "imapct", " ", 
          RowBox[{"equations", ":", " ", 
           RowBox[{"Hamiltonian", " ", "and", " ", "Momentum"}]}]}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"mom", "=", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Lag", ",", 
            RowBox[{"{", "dqs", "}"}]}], "]"}], "//", "Simplify"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ham", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"mom", ",", "dqs"}], "]"}], "-", "Lag"}], "//", 
          "Simplify"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"MomentAndHamil", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"mom", ",", "ham"}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"repQsToQsvar", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"qs", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
        RowBox[{"qsvars", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"repQsvarToQs", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"qsvars", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
        RowBox[{"qs", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"impact", " ", "event"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "detectImpacts", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cnt", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "The", " ", "change", " ", "direction", " ", "method", " ", "and", " ", 
     "this", " ", "impactTriggerStage", " ", "both", " ", "cannot", " ", 
     RowBox[{"work", ".", " ", "I"}], " ", 
     RowBox[{"don", "'"}], "t", " ", 
     RowBox[{"why", ".", " ", "So"}], " ", "I", " ", "just", " ", "use", " ", 
     "the", " ", "distance", " ", "threshold", " ", "checker", " ", "to", " ",
      "detect", " ", 
     RowBox[{"impact", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"impactTriggerStage", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"0", ":", " ", "none"}], ";"}], " ", ">", "0"}], ":", " ", 
      RowBox[{"Triggered", " ", "by", " ", "events", " ", "i"}]}], ",", " ", 
     RowBox[{"but", " ", "matha", " ", "has", " ", "not", " ", 
      RowBox[{"executed", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"detectImpacts", "[", "qsimp0_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rep", ",", "inline", ",", "qsimp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"qsimp", "=", 
         RowBox[{"qsimp0", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "nVars"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"cnt", "=", 
         RowBox[{"cnt", "+", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rep", ":=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"qs", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "->", 
            RowBox[{"qsimp", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"disCurr", "=", 
         RowBox[{"\[Phi]sIsClose", "/.", "rep"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"cnt", "\[Equal]", "1"}], ",", 
          RowBox[{"disPre", "=", "disCurr"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", "n\[Phi]s"}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"dis", "=", 
            RowBox[{"disCurr", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"intheline", "=", 
            RowBox[{
             RowBox[{"\[Phi]sIsInLine", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "/.", "rep"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"disPre", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", "dis"}], ")"}], 
                 "\[LessEqual]", " ", "0.05"}], "&&", " ", "intheline"}], " ",
                ",", 
               RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
             "impactDetectionError"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "\[Equal]", "7"}], " ", "&&", " ", 
              RowBox[{"dis", "<", "0"}], "&&", " ", "intheline"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"impactTriggerStage", ">", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FlagImpact", "=", "True"}], ";", 
              RowBox[{"idxImpactCase", "=", "impactTriggerStage"}]}], ")"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"i", "\[Equal]", 
                RowBox[{"n\[Phi]s", "+", "1"}]}], ",", 
               RowBox[{"FlagImpact", "=", "False"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"i", "\[LessEqual]", "n\[Phi]s"}], ",", 
               RowBox[{
                RowBox[{"FlagImpact", "=", "True"}], ";", 
                RowBox[{"impactTriggerStage", "=", "i"}], ";", 
                RowBox[{"idxImpactCase", "=", "i"}]}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "*)"}], "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[Equal]", 
           RowBox[{"n\[Phi]s", "+", "1"}]}], ",", 
          RowBox[{"FlagImpact", "=", "False"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[LessEqual]", "n\[Phi]s"}], ",", 
          RowBox[{
           RowBox[{"FlagImpact", "=", "True"}], ";", 
           RowBox[{"impactTriggerStage", "=", "i"}], ";", 
           RowBox[{"idxImpactCase", "=", "i"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"FlagImpact", ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<disCurr:\>\"", ",", "disCurr"}], "]"}]}], "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<dis curr:\>\"", ",", "disCurr", ",", "\"\<, prev:\>\"", ",", 
            "disPre"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<    pre*dis:\>\"", ",", 
            RowBox[{"disPre", "*", "disCurr"}], ",", "\"\<,in the line=\>\"", 
            ",", "inlines"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<    i:\>\"", ",", "i", ",", "\"\<,FlagImpact=\>\"", ",", 
            "FlagImpact"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"disPre", "=", "disCurr"}], ";", "\[IndentingNewLine]", 
        "FlagImpact"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",\

 CellChangeTimes->{{3.753207834598749*^9, 3.7532080510250177`*^9}, 
   3.7532081710215*^9, {3.753208257900922*^9, 3.753208322227792*^9}, {
   3.753208394502795*^9, 3.753208464359561*^9}, {3.753208597506633*^9, 
   3.75320860339051*^9}, {3.7532086496034822`*^9, 3.753208684140167*^9}, {
   3.753208716370907*^9, 3.753208757850855*^9}, {3.75320883902801*^9, 
   3.753208923836372*^9}, {3.753208997283626*^9, 3.753209000278064*^9}, {
   3.753209035895211*^9, 3.7532090444164133`*^9}, {3.753209096597743*^9, 
   3.753209162242354*^9}, {3.753209256227212*^9, 3.7532092639865437`*^9}, {
   3.753209342946555*^9, 3.753209464048612*^9}, {3.7532095017852793`*^9, 
   3.7532095040094137`*^9}, {3.753209548035882*^9, 3.753209621390895*^9}, {
   3.7532096518877773`*^9, 3.7532096520201187`*^9}, {3.7532096947164*^9, 
   3.7532097663365717`*^9}, {3.7532098627515297`*^9, 3.753209874950637*^9}, {
   3.753215464168515*^9, 3.753215464514011*^9}, {3.753215506940374*^9, 
   3.753215507432734*^9}, {3.753215539141646*^9, 3.7532155407252817`*^9}, {
   3.753215572668227*^9, 3.753215574881051*^9}, {3.75321592920116*^9, 
   3.753215932881055*^9}, 3.753215995034987*^9, 3.753216161574216*^9, {
   3.753216392678418*^9, 3.753216414650704*^9}, {3.753216577628229*^9, 
   3.753216604660943*^9}, {3.7532166926947927`*^9, 3.753216795316416*^9}, {
   3.7532169151408663`*^9, 3.75321691585322*^9}, {3.7532171299426613`*^9, 
   3.753217136994585*^9}, {3.75321724839464*^9, 3.75321754637252*^9}, {
   3.753217625369699*^9, 3.75321762623173*^9}, {3.75321768624194*^9, 
   3.7532176897003717`*^9}, {3.753217740687544*^9, 3.753217740861993*^9}, {
   3.753217886736161*^9, 3.753217975752591*^9}, {3.753218035661665*^9, 
   3.7532180701883173`*^9}, {3.753218105592867*^9, 3.753218169295578*^9}, {
   3.7532182170270977`*^9, 3.753218223448474*^9}, {3.753218282070709*^9, 
   3.753218361991004*^9}, {3.753218654447254*^9, 3.753218671025569*^9}, {
   3.753218871378562*^9, 3.753218902296809*^9}, {3.753219022483848*^9, 
   3.7532190869104567`*^9}, 3.7532191494944468`*^9, {3.753219259876058*^9, 
   3.753219313310699*^9}, {3.753219504964876*^9, 3.7532195677113857`*^9}, {
   3.753219611804081*^9, 3.7532196864851913`*^9}, {3.753219722018478*^9, 
   3.753219747348176*^9}, {3.753219790372643*^9, 3.753219889395577*^9}, {
   3.753219938269031*^9, 3.753219995069295*^9}, {3.753220251764426*^9, 
   3.753220269265409*^9}, {3.75323123636578*^9, 3.753231322824914*^9}, {
   3.753231755705014*^9, 3.753231757526075*^9}, {3.753231828667966*^9, 
   3.753231838679228*^9}, {3.753231888472735*^9, 3.753231894787478*^9}, {
   3.7532319889366837`*^9, 3.753231991409857*^9}, {3.753232101905052*^9, 
   3.7532321246369534`*^9}, {3.7532322752538633`*^9, 3.753232321989277*^9}, {
   3.7532326407493258`*^9, 3.7532327056424522`*^9}, {3.753232737210969*^9, 
   3.753232746397929*^9}, {3.753232950895122*^9, 3.753232997538137*^9}, {
   3.7532737618776083`*^9, 3.753273843236269*^9}, {3.753273944444821*^9, 
   3.753273969683413*^9}, {3.753274205617531*^9, 3.753274208632481*^9}},
 CellLabel->
  "In[684]:=",ExpressionUUID->"2306f250-5374-4a7e-996d-29957b2bea0e"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.753209550159411*^9, 3.753209551854725*^9}},
 CellLabel->
  "In[648]:=",ExpressionUUID->"8f9a3633-666d-4bb6-9274-3b66b22040cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Solve", " ", "motion", " ", "starting", " ", "from", " ", "t0"}],
     ",", " ", 
    RowBox[{"until", " ", "get", " ", "an", " ", "impact"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"phi", "[", "tt_", "]"}], ":=", 
     RowBox[{"x3", "/.", 
      RowBox[{"t", "\[Rule]", "tt"}]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"OneBounce", "[", 
    RowBox[{"{", 
     RowBox[{"t0_", ",", "qsInit0_", ",", "dqsInit0_"}], "}"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sol", ",", "t1", ",", "qsAfter", ",", "dqsAfter"}], "}"}], ",",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q0Solve", "=", 
       RowBox[{"TurnToEq", "[", 
        RowBox[{
         RowBox[{"qs", "/.", 
          RowBox[{"t", "\[Rule]", "t0"}]}], ",", "qsInit0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dq0Solve", "=", 
       RowBox[{"TurnToEq", "[", 
        RowBox[{
         RowBox[{"dqs", "/.", 
          RowBox[{"t", "\[Rule]", "t0"}]}], ",", "dqsInit0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"idxImpactCase", "=", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", "=", 
       RowBox[{"First", "[", "\[IndentingNewLine]", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ddqSolve", ",", "q0Solve", ",", "dq0Solve"}], "}"}], ",", 
          "qsvars", ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "t0", ",", "timeend"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", "Impact"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}], " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Conditions", "--"}], "--"}], "--"}], "--"}], 
                    "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], "--"}], 
                 "--"}], "--"}], "--"}], "--"}]}], "-"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Method", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<EventLocator\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{"(*", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"1.", " ", "test", " ", "delay", " ", 
                RowBox[{"estimation", ":", " ", 
                 RowBox[{"Good", 
                  RowBox[{"{", 
                   RowBox[{"$q2", "[", "t", "]"}], "}"}]}]}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bad", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"qs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"\[Phi]sIsClose", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], 
                  "\[IndentingNewLine]", "delay", " ", "and", " ", "use", " ", 
                  RowBox[{"$q2", "[", "tt", "]"}]}], "/.", 
                 RowBox[{"tt", "\[Rule]", 
                  RowBox[{"t", " ", "is", " ", "also", " ", "good"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"2.", "test", " ", "no", " ", 
                 RowBox[{"delay", ":", " ", 
                  RowBox[{"All", " ", 
                   RowBox[{"bad", ".", " ", "Only"}], " ", "execute", " ", 
                   RowBox[{"once", ".", "\[IndentingNewLine]", "But"}], " ", 
                   "this", " ", "works"}], ":", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"$q2", "[", "t", "]"}], "+", "2"}], "<", 
                   "0"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{
                "I", " ", "still", " ", "have", " ", "no", " ", "way", " ", 
                 "of", " ", "putting", " ", "a", " ", "function", " ", 
                 RowBox[{"below", ".", " ", "Now"}], " ", "I", " ", "can", 
                 " ", "only", " ", "put", " ", "a", " ", "Nor", " ", 
                 RowBox[{"here", ".", " ", "I"}], " ", "hope", " ", "there", 
                 " ", "is", " ", "a", " ", "better", " ", "solution"}]}]}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"\"\<Event\>\"", "\[RuleDelayed]", 
              RowBox[{"detectImpacts", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"$q1", "[", "t", "]"}], ",", 
                 RowBox[{"$q2", "[", "t", "]"}], ",", 
                 RowBox[{"$q3", "[", "t", "]"}], ",", 
                 RowBox[{"$q4", "[", "t", "]"}], ",", 
                 RowBox[{"$q5", "[", "t", "]"}], ",", 
                 RowBox[{"$q6", "[", "t", "]"}], ",", 
                 RowBox[{"$q7", "[", "t", "]"}], ",", 
                 RowBox[{"$q8", "[", "t", "]"}], ",", 
                 RowBox[{"$q9", "[", "t", "]"}], ",", 
                 RowBox[{"$q10", "[", "t", "]"}], ",", 
                 RowBox[{"$q11", "[", "t", "]"}], ",", 
                 RowBox[{"$q12", "[", "t", "]"}], ",", 
                 RowBox[{"$q13", "[", "t", "]"}], ",", 
                 RowBox[{"$q14", "[", "t", "]"}], ",", 
                 RowBox[{"$q15", "[", "t", "]"}]}], "}"}], "]"}]}], ",", 
             RowBox[{"\"\<Direction\>\"", "\[Rule]", "1"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"Module", "[", 
               RowBox[{
                RowBox[{"{", "}"}], ",", 
                RowBox[{
                 RowBox[{"cnt", "=", 
                  RowBox[{"cnt", "+", "1"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"cnt", "\[LessEqual]", "3"}], ",", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    RowBox[{"$q2", "[", "t", "]"}], ",", "\"\<,\>\"", ",", 
                    RowBox[{"Variables", "[", "qs", "]"}], ",", 
                    RowBox[{"Variables", "[", "qsvars", "]"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<isClose\>\"", ",", 
                    RowBox[{"\[Phi]sIsClose", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "}"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"f", "[", "x_", "]"}], ":=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Hold", "[", 
                    RowBox[{"y", "=", "x"}], "]"}], "\[IndentingNewLine]", 
                    "res"}], "=", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"f", "[", "i", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"ReleaseHold", "[", 
                  RowBox[{"res", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], ";", 
                 "\[IndentingNewLine]", "y"}]}], "\[IndentingNewLine]", "]"}],
               "*)"}], "\[IndentingNewLine]", ",", 
             RowBox[{"\"\<EventAction\>\"", "\[RuleDelayed]", 
              RowBox[{"(", "\[IndentingNewLine]", 
               RowBox[{"Throw", "[", 
                RowBox[{
                 RowBox[{"end", "=", "t"}], ",", "\"\<StopIntegration\>\""}], 
                "]"}], "\[IndentingNewLine]", ")"}]}]}], 
            "\[IndentingNewLine]", "}"}]}], ",", 
          RowBox[{"MaxStepSize", "\[Rule]", "intergrationMaxStepSize"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"sol", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2", ",", "1", ",", "1", ",", "2"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"qBeforeImpact", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"qs", ",", "dqs"}], "}"}], "/.", 
          RowBox[{"t", "\[Rule]", "t1"}]}], ")"}], "/.", "sol"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Reflection", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"qsAfter", ",", "dqsAfter"}], "}"}], "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FlagImpact", "\[Equal]", "False"}], ",", "qBeforeImpact", 
         ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"if", " ", "there", " ", "is", " ", "an", " ", 
           RowBox[{"impact", ":"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Reflection", "[", 
           RowBox[{"\[Phi]sgradDOT\[CapitalLambda]", "[", 
            RowBox[{"[", "idxImpactCase", "]"}], "]"}], "]"}], "[", 
          "qBeforeImpact", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", " ", "result"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FlagImpact", "\[Equal]", "True"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"impactTriggerStage", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"ifprint", ",", 
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Impact at: t=\>\"", ",", "t1", ",", "\"\<,impactcase=\>\"", 
             ",", "idxImpactCase"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"ifprint", ",", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<    disCurr=\>\"", ",", 
               RowBox[{"disCurr", "[", 
                RowBox[{"[", "7", "]"}], "]"}], ",", "\"\<,disPrev=\>\"", ",", 
               RowBox[{"disPre", "[", 
                RowBox[{"[", "7", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"ifprint", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<    Before reflection, q=\>\"", ",", 
             RowBox[{"qBeforeImpact", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,dq=\>\"", ",", 
             RowBox[{"qBeforeImpact", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"ifprint", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<    After reflection\>\"", ",", "dqsAfter"}], 
            "]"}]}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Sow", " ", "the", " ", "output"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Sow", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"qs", "/.", "sol"}], ",", 
            RowBox[{"t0", "\[LessEqual]", "t", "\[LessEqual]", "t1"}]}], 
           "}"}], ",", "\"\<qhist\>\""}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Sow", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"qs", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "/.", "sol"}], ",", 
            RowBox[{"t0", "\[LessEqual]", "t", "\[LessEqual]", "t1"}]}], 
           "}"}], ",", 
          RowBox[{"qsvars", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"t1", ",", "qsAfter", ",", "dqsAfter"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7504761217315397`*^9, 3.750476129220704*^9}, {
   3.7504761676479073`*^9, 3.7504762736418123`*^9}, {3.750476309036336*^9, 
   3.7504763531410227`*^9}, {3.750476419981333*^9, 3.750476569704994*^9}, {
   3.7504769947088413`*^9, 3.750477025151095*^9}, {3.750477142921672*^9, 
   3.750477142924491*^9}, {3.750477253918026*^9, 3.7504773079521313`*^9}, {
   3.7504773929677896`*^9, 3.750477447008443*^9}, {3.750477478582633*^9, 
   3.7504775139946957`*^9}, {3.750477668988633*^9, 3.750477685744553*^9}, 
   3.750477797310213*^9, {3.750477841735621*^9, 3.7504778764145527`*^9}, 
   3.750478045986533*^9, {3.750478360034698*^9, 3.750478380487146*^9}, {
   3.750560777669405*^9, 3.750560811060111*^9}, {3.7518094274112997`*^9, 
   3.751809432078514*^9}, 3.751810549597258*^9, {3.751810972218049*^9, 
   3.751811035930869*^9}, {3.751811195253768*^9, 3.751811198010672*^9}, 
   3.751811543696804*^9, {3.7518136894118757`*^9, 3.751813722623609*^9}, {
   3.751814152724784*^9, 3.751814159214383*^9}, {3.7518143249408903`*^9, 
   3.751814393856371*^9}, {3.751814425789665*^9, 3.751814430088407*^9}, {
   3.7518144651921253`*^9, 3.7518144903115997`*^9}, {3.75181463698282*^9, 
   3.751814672033071*^9}, {3.751814859548841*^9, 3.751814863206459*^9}, {
   3.751814901959716*^9, 3.7518150230612907`*^9}, 3.751819171169711*^9, 
   3.7518193964366713`*^9, 3.751820558487013*^9, {3.7518205974151983`*^9, 
   3.751820601632884*^9}, {3.751820693326942*^9, 3.75182069372966*^9}, {
   3.7518208705610037`*^9, 3.751820914545474*^9}, {3.75182095387309*^9, 
   3.751820959943351*^9}, {3.751820993789261*^9, 3.751820994117293*^9}, {
   3.751821076403688*^9, 3.751821076804986*^9}, {3.75182111709214*^9, 
   3.751821123041273*^9}, 3.751821157527691*^9, {3.751821370832739*^9, 
   3.7518213756108828`*^9}, {3.7518214264363613`*^9, 3.751821428889292*^9}, {
   3.751821462825779*^9, 3.7518215048037786`*^9}, {3.7518215353029623`*^9, 
   3.751821555389255*^9}, {3.751824164900526*^9, 3.751824185457097*^9}, {
   3.751824402416218*^9, 3.75182440853095*^9}, {3.751824917955853*^9, 
   3.751824920264224*^9}, 3.751827156650981*^9, {3.7518272693002357`*^9, 
   3.7518272932978773`*^9}, {3.751827396239921*^9, 3.751827449326714*^9}, {
   3.751828138499563*^9, 3.7518281791478662`*^9}, {3.7518283966065397`*^9, 
   3.7518284388297453`*^9}, {3.751828481746797*^9, 3.751828486765181*^9}, {
   3.7518285495761967`*^9, 3.751828567122414*^9}, {3.751828670701817*^9, 
   3.751828673451902*^9}, {3.7518287952692823`*^9, 3.751828798773055*^9}, {
   3.75182890350634*^9, 3.75182899731742*^9}, {3.751829029419676*^9, 
   3.751829041144011*^9}, {3.751829148382429*^9, 3.7518291499184303`*^9}, {
   3.751829185493903*^9, 3.7518291856464663`*^9}, 3.7518292679919977`*^9, {
   3.7518293247273207`*^9, 3.7518293480638323`*^9}, {3.751829403830161*^9, 
   3.751829421385828*^9}, {3.751829490644965*^9, 3.751829597784523*^9}, {
   3.7518296498279123`*^9, 3.75182966408714*^9}, {3.751829722343792*^9, 
   3.7518297224489603`*^9}, {3.751829762537745*^9, 3.751829785997316*^9}, {
   3.7518299513936453`*^9, 3.751829957763762*^9}, {3.75183012632574*^9, 
   3.7518301480284567`*^9}, {3.751832389204402*^9, 3.7518324039854794`*^9}, {
   3.7518333181571417`*^9, 3.751833358675832*^9}, {3.7518334100472927`*^9, 
   3.751833466714738*^9}, {3.751833669137703*^9, 3.751833669763919*^9}, {
   3.751833848591364*^9, 3.751833898697631*^9}, {3.751834638387701*^9, 
   3.751834647942827*^9}, {3.7518347470762672`*^9, 3.7518347475545683`*^9}, {
   3.751834788736672*^9, 3.751834789848575*^9}, {3.7518348214708233`*^9, 
   3.751834834571272*^9}, {3.751845778949648*^9, 3.751845783497786*^9}, {
   3.751845851944026*^9, 3.7518458520841503`*^9}, {3.7518459675030193`*^9, 
   3.751845987318261*^9}, {3.751846435245915*^9, 3.751846487079608*^9}, {
   3.751846525254092*^9, 3.7518465625703697`*^9}, {3.7518466303986177`*^9, 
   3.75184670644073*^9}, 3.751847172134926*^9, {3.751847461973982*^9, 
   3.751847495658023*^9}, {3.7518481863405037`*^9, 3.751848310318544*^9}, {
   3.751848426680676*^9, 3.751848445658164*^9}, 3.751851122423481*^9, 
   3.751851654430058*^9, {3.751854497831255*^9, 3.751854503878433*^9}, {
   3.753141938998219*^9, 3.7531419972619267`*^9}, {3.7531420314179907`*^9, 
   3.753142096318643*^9}, {3.753142140177408*^9, 3.753142141528945*^9}, {
   3.75314223896776*^9, 3.753142405950572*^9}, {3.753142545953835*^9, 
   3.753142551074903*^9}, {3.7531478435793877`*^9, 3.753147845439683*^9}, {
   3.753147892224069*^9, 3.7531479249810658`*^9}, {3.753147962437405*^9, 
   3.7531479626161623`*^9}, {3.7531480050438538`*^9, 3.753148006721374*^9}, {
   3.753148075093494*^9, 3.753148087557843*^9}, {3.753148290235146*^9, 
   3.7531483161548634`*^9}, {3.753148378172127*^9, 3.753148437487644*^9}, {
   3.753148616556013*^9, 3.753148680400259*^9}, {3.7531496529075203`*^9, 
   3.753149658163287*^9}, {3.75314995788833*^9, 3.753149975352601*^9}, {
   3.753150206019153*^9, 3.7531502132155657`*^9}, {3.7531502636107197`*^9, 
   3.753150322711405*^9}, {3.7531503561361732`*^9, 3.75315036969411*^9}, {
   3.753150466614624*^9, 3.753150488768148*^9}, {3.7531506178835287`*^9, 
   3.7531506627873917`*^9}, {3.753150822886591*^9, 3.753150860475502*^9}, {
   3.7531510295743713`*^9, 3.7531510556881*^9}, {3.753151089150065*^9, 
   3.7531511314662647`*^9}, {3.753151172535486*^9, 3.753151362742996*^9}, {
   3.753151406480207*^9, 3.753151407634336*^9}, {3.7531514467010727`*^9, 
   3.753151573932012*^9}, {3.753153277391979*^9, 3.753153340062655*^9}, {
   3.753153552631448*^9, 3.753153561168417*^9}, {3.753153701131999*^9, 
   3.753153772592599*^9}, {3.753153803643229*^9, 3.7531538123160686`*^9}, {
   3.7531539246273108`*^9, 3.753153939513377*^9}, {3.753154704205977*^9, 
   3.7531547895601177`*^9}, {3.753155027264474*^9, 3.75315503148147*^9}, {
   3.753191400692848*^9, 3.753191406475366*^9}, {3.753192023863386*^9, 
   3.753192266303565*^9}, {3.7531922973415403`*^9, 3.753192409309186*^9}, {
   3.753192505748074*^9, 3.753192543311328*^9}, {3.753192604675251*^9, 
   3.753192617469833*^9}, {3.753192702965097*^9, 3.753192746599124*^9}, 
   3.753193020031439*^9, {3.753193070666342*^9, 3.753193074450103*^9}, 
   3.7531931081688547`*^9, {3.753193154383108*^9, 3.753193266122078*^9}, {
   3.753193328047451*^9, 3.753193329588401*^9}, {3.7531935870242167`*^9, 
   3.753193643764954*^9}, {3.7531937782431593`*^9, 3.753193830507131*^9}, {
   3.7531939103366947`*^9, 3.753193925503065*^9}, {3.753193960126577*^9, 
   3.753193986538533*^9}, {3.753194056419527*^9, 3.7531940615436707`*^9}, {
   3.753194095851488*^9, 3.753194121924985*^9}, {3.75319415427207*^9, 
   3.7531941934704*^9}, {3.753194555694343*^9, 3.7531947174028187`*^9}, {
   3.753194769236444*^9, 3.753194775623186*^9}, {3.753194858426182*^9, 
   3.753194900092658*^9}, {3.753195278950699*^9, 3.753195279431429*^9}, {
   3.753195341798773*^9, 3.7531953605324297`*^9}, {3.753196292888816*^9, 
   3.753196406536023*^9}, {3.7531964505564947`*^9, 3.7531965360018187`*^9}, {
   3.753196567454517*^9, 3.7531965701253223`*^9}, 3.7532011930466423`*^9, {
   3.753201245187977*^9, 3.753201272938942*^9}, {3.753201414917768*^9, 
   3.75320142982024*^9}, {3.753202068597209*^9, 3.753202071751934*^9}, {
   3.753202546091899*^9, 3.753202573829514*^9}, {3.75320260601486*^9, 
   3.7532026643327417`*^9}, {3.753202702529213*^9, 3.753202710499673*^9}, {
   3.75320378367268*^9, 3.753203787951437*^9}, {3.753203962775283*^9, 
   3.7532040161316137`*^9}, {3.753204052949771*^9, 3.7532041112647667`*^9}, {
   3.7532041492693043`*^9, 3.753204149913784*^9}, {3.753204603471919*^9, 
   3.753204728501006*^9}, {3.753204774191391*^9, 3.753204849318205*^9}, {
   3.753204903731311*^9, 3.75320508011068*^9}, {3.753205127064929*^9, 
   3.753205296422995*^9}, {3.753205406946003*^9, 3.753205477066968*^9}, {
   3.753205544594179*^9, 3.7532055625677023`*^9}, {3.753207783504469*^9, 
   3.7532078276765547`*^9}, {3.753208506699275*^9, 3.753208513214471*^9}, {
   3.753208557983189*^9, 3.753208558120639*^9}, {3.753208663427884*^9, 
   3.753208730944916*^9}, {3.753209662558545*^9, 3.753209672635488*^9}, 
   3.75320977874358*^9, {3.753209882897333*^9, 3.753209883770441*^9}, {
   3.753209944393691*^9, 3.753209956862294*^9}, {3.753210008794725*^9, 
   3.753210030319435*^9}, {3.7532102000647993`*^9, 3.753210224886005*^9}, {
   3.753210342147262*^9, 3.753210375221697*^9}, {3.753210410159033*^9, 
   3.753210422893136*^9}, {3.753217761575303*^9, 3.7532177768022413`*^9}, {
   3.753217834775443*^9, 3.75321784600528*^9}, {3.753218826721607*^9, 
   3.753218831427638*^9}, {3.753218921022545*^9, 3.753218925689389*^9}, {
   3.7532189578136272`*^9, 3.753218962501523*^9}, {3.753219409123101*^9, 
   3.7532194425309134`*^9}, {3.7532197104704857`*^9, 3.753219711858034*^9}, {
   3.7532205426770678`*^9, 3.753220544750979*^9}, {3.753232379816474*^9, 
   3.7532324083918037`*^9}, {3.753232446922385*^9, 3.753232451634166*^9}, {
   3.753232497893672*^9, 3.7532324990461397`*^9}, {3.75323256262099*^9, 
   3.753232566997038*^9}, {3.753242924057419*^9, 3.753242937012697*^9}, {
   3.7532746651491833`*^9, 
   3.753274665317669*^9}},ExpressionUUID->"e0ff026a-7148-404f-ab63-\
484869baeb59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Do", " ", "simulations", " ", "until", " ", "end"}], "=", "T"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BouncingBall", "[", 
    RowBox[{"qsInit_", ",", "dqsInit_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", ",", "end", ",", "bounces"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"Reap", "[", 
        RowBox[{
         RowBox[{"Catch", "[", 
          RowBox[{"NestWhile", "[", 
           RowBox[{"OneBounce", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "qsInit", ",", "dqsInit"}], "}"}], ",", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", "timeend"}], "]"}], ",", 
            "1", ",", "MAXIMPACTTIMES"}], "]"}], "]"}], ",", "_", ",", 
         "Rule"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"end", "=", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"data", "=", 
       RowBox[{"Last", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bounces", "=", 
       RowBox[{"(", 
        RowBox[{"\"\<Bounces\>\"", "/.", "data"}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"end", ",", "data", ",", "bounces"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7505575632152367`*^9, 3.75055757255194*^9}, {
  3.750560855408534*^9, 3.750560876916593*^9}, {3.751811044841227*^9, 
  3.7518110481870604`*^9}, {3.751814718811716*^9, 3.751814735253277*^9}, {
  3.751834670015415*^9, 3.751834673135092*^9}, {3.751834732200005*^9, 
  3.7518347348659487`*^9}, {3.751848325958764*^9, 3.751848335241559*^9}, {
  3.753141800779183*^9, 3.753141830762875*^9}, {3.753141874961904*^9, 
  3.753141897652791*^9}, {3.75314780418496*^9, 3.753147805275179*^9}, {
  3.753147868605445*^9, 3.7531478697645807`*^9}, {3.7531504172691803`*^9, 
  3.753150423170867*^9}},
 CellLabel->
  "In[650]:=",ExpressionUUID->"40936615-91b9-4646-bde0-8d7efcef123a"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.753143755907742*^9, 3.753143854677706*^9}, {
   3.753143929782723*^9, 3.753143999339322*^9}, {3.753144460268527*^9, 
   3.753144490376947*^9}, {3.753144588361569*^9, 3.7531445886129513`*^9}, {
   3.753145803446353*^9, 3.75314581182533*^9}, {3.753147626224401*^9, 
   3.7531476507506933`*^9}, {3.7531476934888678`*^9, 
   3.7531477300481567`*^9}, {3.75314946051698*^9, 3.753149480007215*^9}, 
   3.753149528145368*^9, {3.753149578287274*^9, 3.753149579255807*^9}, {
   3.75314986027322*^9, 3.7531498729859047`*^9}, {3.753150124452935*^9, 
   3.753150146613904*^9}, {3.753150448126668*^9, 3.753150482963875*^9}, {
   3.7531516845917883`*^9, 3.7531516849259777`*^9}, 3.753151826777287*^9, {
   3.753151881068465*^9, 3.753151970505578*^9}, 3.7531527617286863`*^9, {
   3.7531528279398613`*^9, 3.753152828090502*^9}, 3.753153053611883*^9, {
   3.753178253351746*^9, 3.7531782644243603`*^9}, {3.753181222498272*^9, 
   3.753181256828682*^9}, 3.753188145496003*^9, {3.75318817814847*^9, 
   3.75318837211128*^9}, {3.753188435502331*^9, 3.753188439039528*^9}, {
   3.753188470886509*^9, 3.7531885782611837`*^9}, {3.753188613462459*^9, 
   3.753188617467186*^9}, {3.753188720237339*^9, 3.753188722232069*^9}, {
   3.7531887891396217`*^9, 3.7531887893050528`*^9}, {3.753188824699559*^9, 
   3.753188831532641*^9}, {3.7531889641942997`*^9, 3.753188987567341*^9}, {
   3.7531891805224533`*^9, 3.75318918288023*^9}, {3.753189216086955*^9, 
   3.753189227816251*^9}, {3.753189355939034*^9, 3.753189356447727*^9}, {
   3.75318948885256*^9, 3.7531895085478067`*^9}, {3.7531898551849823`*^9, 
   3.753189858924077*^9}, {3.753189889321451*^9, 3.753189910034552*^9}, {
   3.753190113555085*^9, 3.753190120741082*^9}, {3.7531902200331078`*^9, 
   3.753190452344761*^9}, {3.753190495554503*^9, 3.753190536047328*^9}, {
   3.753190680173583*^9, 3.7531906849873943`*^9}, {3.753190811918062*^9, 
   3.7531908296658707`*^9}, 3.753190859669702*^9, {3.753190968887805*^9, 
   3.75319106674862*^9}, {3.753191147952829*^9, 3.753191178701975*^9}, {
   3.753191210816904*^9, 3.753191214554433*^9}, {3.7531912493598433`*^9, 
   3.753191297911701*^9}, {3.7531929007484837`*^9, 3.7531929700586653`*^9}, {
   3.753193653302227*^9, 3.753193671432386*^9}, {3.753195084578334*^9, 
   3.7531950849977217`*^9}, {3.753203662436701*^9, 3.75320369595574*^9}, {
   3.753204343411366*^9, 3.7532043562945843`*^9}, {3.753204856032777*^9, 
   3.753204896129279*^9}, 3.753207766852755*^9},
 CellLabel->
  "In[651]:=",ExpressionUUID->"fa9669e8-62b9-43d5-a0de-8bf4be91992f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Reflection", "[", "\[Phi]gradDOT\[CapitalLambda]_", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"qsImpTMinus_", ",", "dqsImpTMinus_"}], "}"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"qsImpTPlus", ",", "dqsImpTPlus"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<\[Phi]gradDOT\[CapitalLambda]\>\"", ",", 
         "\[Phi]gradDOT\[CapitalLambda]", ",", "\"\<,qsImpTPlus\>\"", ",", 
         "qsImpTPlus", ",", "\"\<,dqsImpTPlus\>\"", ",", "dqsImpTPlus"}], 
        "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"qsRepTMinus", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"qs", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", 
          RowBox[{"qsImpTMinus", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dqsRepTMinus", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"dqs", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", 
          RowBox[{"dqsImpTMinus", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"repTMinus", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"qsRepTMinus", ",", "dqsRepTMinus"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"qsRepTPlus", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"qs", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", 
          RowBox[{"qsImpTMinus", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dqsTPlus", "=", 
       RowBox[{"dqs", "/.", 
        RowBox[{"t", "\[Rule]", "tplus"}]}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "only", " ", "dqs_t", "_plus", " ", "is", " ", "what", " ", "we", " ", 
        "want", " ", "to", " ", "solve"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dqsRepTPlus", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"dqs", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", 
          RowBox[{"dqsTPlus", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nVars"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"repTPlus", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"qsRepTPlus", ",", "dqsRepTPlus"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"impEqsLeftPlus", "=", 
       RowBox[{"MomentAndHamil", "/.", "repTPlus"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"impEqsLeftMinus", "=", 
       RowBox[{"MomentAndHamil", "/.", "repTMinus"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"impEqsRight", "=", 
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{"\[Phi]gradDOT\[CapitalLambda]", ",", "0"}], "]"}], "/.", 
        "repTMinus"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Only", " ", "qs", " ", "here"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"impEqs", "=", 
       RowBox[{"TurnToEq", "[", 
        RowBox[{
         RowBox[{"impEqsLeftPlus", "-", "impEqsLeftMinus"}], ",", 
         "impEqsRight"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"impVars", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"dqsTPlus", ",", "\[CapitalLambda]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Impactsolu", "=", 
       RowBox[{
        RowBox[{"Quiet", "[", 
         RowBox[{"Solve", "[", 
          RowBox[{"impEqs", ",", "impVars"}], "]"}], "]"}], " ", "//", 
        "FullSimplify"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"We", " ", "get", " ", "2", " ", 
         RowBox[{"solutions", ".", " ", "Choose"}], " ", "the", " ", "one", 
         " ", "whose", " ", "\[Lambda]", " ", "is", " ", "not", " ", "zero"}],
         ",", " ", 
        RowBox[{
         RowBox[{"i", ".", "e", ".", " ", "larger"}], " ", 
         RowBox[{"abs", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"Impactsolu", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}], "]"}], ">", 
         RowBox[{"Abs", "[", 
          RowBox[{"Impactsolu", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Impactsolu", "=", 
         RowBox[{"Impactsolu", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], 
        RowBox[{"(*", " ", 
         RowBox[{"1", "st", " ", "solu"}], " ", "*)"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Impactsolu", "=", 
         RowBox[{"Impactsolu", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], 
       RowBox[{"(*", " ", 
        RowBox[{"2", "nd", " ", "solu"}], " ", "*)"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<lambda\>\"", ",", 
          RowBox[{"Impactsolu", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "\"\<,\>\"", ",", 
          RowBox[{"Impactsolu", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"output", " ", "q", " ", "and", " ", "dq"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"qsImpTMinus", ",", 
        RowBox[{"dqsTPlus", "/.", "Impactsolu"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.750476607037531*^9, 3.750476642434149*^9}, {
   3.7504767201235113`*^9, 3.750476728450426*^9}, {3.7504776284563227`*^9, 
   3.750477652723486*^9}, {3.750477695734582*^9, 3.750477723625296*^9}, {
   3.750555389208139*^9, 3.750555389526107*^9}, {3.750555445695014*^9, 
   3.750555460889456*^9}, {3.7505556727595654`*^9, 3.750555686827911*^9}, {
   3.7505557653607073`*^9, 3.750555822716032*^9}, {3.7505558619755774`*^9, 
   3.7505558940576982`*^9}, {3.750555948925303*^9, 3.750556278350726*^9}, {
   3.750556452182089*^9, 3.7505564564880743`*^9}, {3.750556492989849*^9, 
   3.7505564944326077`*^9}, {3.750556524477441*^9, 3.750556534727221*^9}, {
   3.7505566641162233`*^9, 3.750556688161914*^9}, {3.7505568810314837`*^9, 
   3.750556887658492*^9}, {3.7505569661438303`*^9, 3.750556975929315*^9}, {
   3.7505571272372103`*^9, 3.750557139182925*^9}, {3.750557205489769*^9, 
   3.750557226080154*^9}, {3.7505574028205023`*^9, 3.750557405041099*^9}, {
   3.7505574979778557`*^9, 3.750557498097147*^9}, {3.750557589290965*^9, 
   3.750557590170926*^9}, 3.750557622375442*^9, {3.750557659938795*^9, 
   3.750557881750708*^9}, {3.75055791257204*^9, 3.7505579441567163`*^9}, {
   3.7505579797032423`*^9, 3.750558008016787*^9}, {3.750558046506523*^9, 
   3.7505580853951483`*^9}, {3.75056090825946*^9, 3.750560914056218*^9}, {
   3.751808066571528*^9, 3.751808067597436*^9}, {3.751811071085163*^9, 
   3.751811106625822*^9}, {3.7518112234147587`*^9, 3.751811238647118*^9}, {
   3.751813621664996*^9, 3.751813654246397*^9}, {3.751813733824597*^9, 
   3.751813781212036*^9}, {3.7518138594856567`*^9, 3.7518139498690987`*^9}, 
   3.751819421430031*^9, {3.751824932547532*^9, 3.751824941801251*^9}, {
   3.751827094386097*^9, 3.75182709609726*^9}, {3.751844702952849*^9, 
   3.751844726670936*^9}, {3.751844837137067*^9, 3.751844980624551*^9}, {
   3.751845012363587*^9, 3.7518450407430153`*^9}, {3.751845104911051*^9, 
   3.751845107672676*^9}, {3.751845188779893*^9, 3.751845198428344*^9}, {
   3.751845573158636*^9, 3.751845620098913*^9}, {3.7518458018566093`*^9, 
   3.7518458251051807`*^9}, {3.751845859504902*^9, 3.751845862964486*^9}, {
   3.7518459934842997`*^9, 3.751846001635915*^9}, {3.751846076267425*^9, 
   3.7518461331302357`*^9}, {3.751846584366762*^9, 3.751846602917153*^9}, {
   3.751847606421907*^9, 3.751847621141199*^9}, 3.751848563580771*^9, 
   3.751854397830826*^9, {3.753142453456744*^9, 3.753142533384399*^9}, 
   3.753142574024329*^9, {3.753142924328897*^9, 3.753142925672587*^9}, {
   3.753145493078397*^9, 3.753145498121503*^9}, {3.7531457897958927`*^9, 
   3.753145796227804*^9}, {3.7531473492269173`*^9, 3.7531473851331778`*^9}, {
   3.75314742161835*^9, 3.7531474293340263`*^9}, {3.753147469619299*^9, 
   3.7531476161445*^9}, {3.753151675797883*^9, 3.753151678153345*^9}, {
   3.753151726939601*^9, 3.7531517620363894`*^9}, {3.75315184265104*^9, 
   3.753151893176797*^9}, {3.7531519552286654`*^9, 3.753152041007675*^9}, {
   3.753152103169837*^9, 3.7531521058272533`*^9}, {3.753152198400902*^9, 
   3.753152213834404*^9}, {3.753152249282364*^9, 3.753152345153028*^9}, {
   3.75315238089981*^9, 3.753152385339613*^9}, {3.753152429078621*^9, 
   3.753152446159883*^9}, {3.7531526732346897`*^9, 3.7531527001605043`*^9}, {
   3.753152746999831*^9, 3.7531528210260267`*^9}, {3.7531528532486677`*^9, 
   3.753152855025992*^9}, 3.753152890551375*^9, {3.7531529492243233`*^9, 
   3.753152987764676*^9}, 3.753153086058975*^9, {3.753153117155714*^9, 
   3.7531531883922367`*^9}, {3.753153224511661*^9, 3.7531532249760237`*^9}, 
   3.753153608887973*^9, {3.753190082541017*^9, 3.753190106577935*^9}, {
   3.753190950476935*^9, 3.753190952568366*^9}, 3.753191032277556*^9, {
   3.753191362560939*^9, 3.753191382399898*^9}, {3.7531950149390497`*^9, 
   3.7531950452742023`*^9}, {3.7531951132089863`*^9, 
   3.7531951322848997`*^9}, {3.753195175268412*^9, 3.753195193721767*^9}, 
   3.7532041720309353`*^9, {3.753205334218586*^9, 3.753205350446896*^9}, {
   3.753205582966201*^9, 3.753205585782115*^9}},
 CellLabel->
  "In[652]:=",ExpressionUUID->"875d521e-6ce2-4b9a-b80a-58a4c52961fe"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.753152314106468*^9, 3.753152328794524*^9}},
 CellLabel->
  "In[653]:=",ExpressionUUID->"ac0145c6-4762-46b0-86ee-726af44fa57c"]
},
WindowSize->{1080, 826},
WindowMargins->{{0, Automatic}, {18, Automatic}},
Magnification->1.5,
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 23577, 524, 4279, "Input",ExpressionUUID->"2306f250-5374-4a7e-996d-29957b2bea0e"],
Cell[24138, 546, 175, 3, 47, "Input",ExpressionUUID->"8f9a3633-666d-4bb6-9274-3b66b22040cb"],
Cell[24316, 551, 22151, 427, 2289, "Input",ExpressionUUID->"e0ff026a-7148-404f-ab63-484869baeb59"],
Cell[46470, 980, 2257, 53, 354, "Input",ExpressionUUID->"40936615-91b9-4646-bde0-8d7efcef123a"],
Cell[48730, 1035, 2572, 36, 47, "Input",ExpressionUUID->"fa9669e8-62b9-43d5-a0de-8bf4be91992f"],
Cell[51305, 1073, 10544, 218, 1272, "Input",ExpressionUUID->"875d521e-6ce2-4b9a-b80a-58a4c52961fe"],
Cell[61852, 1293, 175, 3, 47, "Input",ExpressionUUID->"ac0145c6-4762-46b0-86ee-726af44fa57c"]
}
]
*)

